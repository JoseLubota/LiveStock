@model IEnumerable<LiveStock.Core.Models.Camp>

@{
    ViewData["Title"] = "Camp Management";
    Layout = "_Layout";
}

<div class="container-fluid">
    <div class="row">
        <!-- Sidebar Navigation -->
        <nav class="col-md-3 col-lg-2 d-md-block bg-dark-green sidebar collapse">
            <div class="position-sticky pt-3">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link text-white" asp-action="Dashboard">
                            <i class="fas fa-tachometer-alt me-2"></i>
                            Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" asp-action="Sheep">
                            <i class="fas fa-sheep me-2"></i>
                            Sheep Management
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" asp-action="Cows">
                            <i class="fas fa-cow me-2"></i>
                            Cow Management
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white active" asp-action="Camps">
                            <i class="fas fa-map-marker-alt me-2"></i>
                            Camps
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" asp-action="Staff">
                            <i class="fas fa-users me-2"></i>
                            Staff Management
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" asp-action="Tasks">
                            <i class="fas fa-tasks me-2"></i>
                            Tasks
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" asp-action="Water">
                            <i class="fas fa-tint me-2"></i>
                            Water & Rainfall
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" asp-action="Assets">
                            <i class="fas fa-tools me-2"></i>
                            Assets
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" asp-action="Finance">
                            <i class="fas fa-dollar-sign me-2"></i>
                            Finance
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" asp-action="Notes">
                            <i class="fas fa-sticky-note me-2"></i>
                            Notes
                        </a>
                    </li>
                    <li class="nav-item mt-3">
                        <a class="nav-link text-warning" asp-controller="Account" asp-action="Logout">
                            <i class="fas fa-sign-out-alt me-2"></i>
                            Logout
                        </a>
                    </li>
                </ul>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
<div class="module-hero" style="background-image: url('@Url.Content("~/Image/IMG-20251025-WA0028.jpg")'); background-size: cover; background-position: center; border-radius: 12px; position: relative; margin-bottom: 1rem;">
                <div class="module-overlay"></div>
                <div class="module-hero-content">
                    <h2 class="h3 mb-1">Camp Management</h2>
                    <p class="mb-0">Quick overview of camps and livestock distribution.</p>
                </div>
            </div>
            <style>
                .module-hero { position: relative; min-height: 220px; }
                .module-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.35); border-radius: 12px; }
                .module-hero-content { position: relative; z-index: 1; color: #fff; padding: 1.25rem 1.5rem; }
            </style>
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">Camp Management</h1>
                <div class="text-muted">
                    <small>Total Farm Area: 2,300 hectares | 15 Camps | ~153.33 hectares per camp</small>
                </div>
            </div>

            <!-- Camp Grid -->
            <div class="row">
                @foreach (var camp in Model.OrderBy(c => c.CampNumber))
                {
                    <div class="col-lg-4 col-md-6 mb-4">
                        <div class="card shadow h-100">
                            <div class="card-header bg-primary text-white text-center">
                                <h5 class="mb-0">Camp @camp.CampNumber</h5>
                            </div>
                            <div class="card-body">
                                <div class="row text-center mb-3">
                                    <div class="col-6">
                                        <div class="camp-stat">
                                            <i class="fas fa-sheep fa-2x text-success mb-2"></i>
                                            <h4 class="text-success">@camp.Sheep.Count</h4>
                                            <small class="text-muted">Sheep</small>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="camp-stat">
                                            <i class="fas fa-cow fa-2x text-info mb-2"></i>
                                            <h4 class="text-info">@camp.Cows.Count</h4>
                                            <small class="text-muted">Cows</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="camp-details mb-3">
                                    <p class="mb-1"><strong>Area:</strong> @camp.Hectares hectares</p>
                                    <p class="mb-1"><strong>Total Livestock:</strong> @(camp.Sheep.Count + camp.Cows.Count)</p>
                                    <p class="mb-0"><strong>Capacity:</strong> 
                                        @if ((camp.Sheep.Count + camp.Cows.Count) > 50)
                                        {
                                            <span class="text-danger">High</span>
                                        }
                                        else if ((camp.Sheep.Count + camp.Cows.Count) > 30)
                                        {
                                            <span class="text-warning">Medium</span>
                                        }
                                        else
                                        {
                                            <span class="text-success">Good</span>
                                        }
                                    </p>
                                </div>
                                
                                <div class="d-grid gap-2">
                                    <a asp-action="CampDetails" asp-route-id="@camp.Id" 
                                       class="btn btn-outline-primary">
                                        <i class="fas fa-eye me-2"></i>View Details
                                    </a>
                                    <button class="btn btn-outline-success" onclick="showMoveLivestockModal(@camp.Id, @camp.CampNumber)">
                                        <i class="fas fa-exchange-alt me-2"></i>Move Livestock
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>

            <!-- Farm Overview -->
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card shadow">
                        <div class="card-header bg-success text-white">
                            <h6 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Farm Overview</h6>
                        </div>
                        <div class="card-body">
                            <div class="row text-center">
                                <div class="col-md-3">
                                    <div class="overview-stat">
                                        <h3 class="text-primary">@Model.Sum(c => c.Sheep.Count)</h3>
                                        <p class="text-muted">Total Sheep</p>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="overview-stat">
                                        <h3 class="text-info">@Model.Sum(c => c.Cows.Count)</h3>
                                        <p class="text-muted">Total Cows</p>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="overview-stat">
                                        <h3 class="text-success">@Model.Sum(c => c.Sheep.Count + c.Cows.Count)</h3>
                                        <p class="text-muted">Total Livestock</p>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="overview-stat">
                                        <h3 class="text-warning">@Model.Count(c => (c.Sheep.Count + c.Cows.Count) > 50)</h3>
                                        <p class="text-muted">High Capacity Camps</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<!-- Move Livestock Modal -->
<div class="modal fade" id="moveLivestockModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title">Move Livestock Between Camps</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="moveLivestockForm" asp-action="MoveAnimal" method="post">
                    <input type="hidden" name="fromCampId" id="fromCampId" />
                    <div class="mb-3">
                        <label class="form-label">From Camp:</label>
                        <input type="text" class="form-control" id="fromCampText" readonly />
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Animal Type:</label>
                        <select class="form-control" name="animalType" required>
                            <option value="">Select Animal Type</option>
                            <option value="Sheep">Sheep</option>
                            <option value="Cow">Cow</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Animal ID:</label>
                        <input type="number" class="form-control" name="animalId" placeholder="Enter animal ID" required />
                    </div>
                    <div class="mb-3">
                        <label class="form-label">To Camp:</label>
                        <select class="form-control" name="toCampId" required>
                            <option value="">Select Destination Camp</option>
                            @foreach (var c in Model.OrderBy(c => c.CampNumber))
                            {
                                <option value="@c.Id">Camp @c.CampNumber</option>
                            }
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Reason (optional):</label>
                        <textarea class="form-control" name="reason" rows="2" placeholder="Why is the animal being moved?"></textarea>
                    </div>
                    <div class="d-flex justify-content-end gap-2">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-success">Move Livestock</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    function showMoveLivestockModal(campId, campNumber) {
        document.getElementById('fromCampId').value = campId;
        document.getElementById('fromCampText').value = `Camp ${campNumber}`;
        const modal = new bootstrap.Modal(document.getElementById('moveLivestockModal'));
        modal.show();
    }
</script>

<style>
    .sidebar {
        min-height: 100vh;
        box-shadow: inset -1px 0 0 rgba(0, 0, 0, .1);
    }
    
    .sidebar .nav-link {
        font-weight: 500;
        color: #333;
        padding: 0.75rem 1rem;
        border-radius: 0.25rem;
        margin: 0.125rem 0.5rem;
        transition: all 0.3s ease;
    }
    
    .sidebar .nav-link:hover,
    .sidebar .nav-link.active {
        background-color: rgba(255, 255, 255, 0.1);
        color: var(--orange-yellow) !important;
    }
    
    .card {
        border: none;
        border-radius: 15px;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }
    
    .camp-stat {
        padding: 1rem;
        border-radius: 10px;
        background-color: #f8f9fa;
    }
    
    .overview-stat {
        padding: 1rem;
    }
    
    .overview-stat h3 {
        margin-bottom: 0.5rem;
        font-weight: bold;
    }
    
    .btn {
        border-radius: 10px;
        font-weight: 600;
    }
    
    .form-control {
        border-radius: 10px;
        border: 2px solid #e9ecef;
        transition: border-color 0.3s ease;
    }
    
    .form-control:focus {
        border-color: var(--medium-green);
        box-shadow: 0 0 0 0.2rem rgba(78, 113, 69, 0.25);
    }
</style>